/* ! Loopbutton v1.0.0 Copyright 2014 Charlotte Dunois https://github.com/CharlotteDunois/videojs-loopbutton/blob/master/LICENSE.md ! */
videojs.plugin('loopbutton', function(options) {
	var player = this;
	var loop = false;
	
	var vjsButton = videojs.getComponent('Button');
	videojs.LoopButton = videojs.extend(vjsButton, {
		constructor: function(player, options) {
			vjsButton.call(this, player, options);
			this.on('click', this.onClick);
		},
		onClick: function() {
			if(loop == true) {
				loop = false;
				this.removeClass('vjs-control-active');
			} else {
				loop = true;
				this.addClass('vjs-control-active');
			}
		}
    });

	var createLoopButton = function() {
		var props = {
			className: 'vjs-loop-button vjs-control',
			innerHTML: '<div class="vjs-control-content"><i class="vjs-icon-replay"></i></div>', 
			role: 'button',
			'aria-live': 'polite', 
			tabIndex: 0
		};

		return videojs.createEl('button', props);
	};

    player.ready(function() {
    	LoopButtonInstance = new videojs.LoopButton(this, {el: createLoopButton(), name: 'woop' });
		player.controlBar.addChild(LoopButtonInstance);
		
		player.on('ended', function() {
			if(loop == true) {
				player.play();
			}
		});
	});
});
